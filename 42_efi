#!/bin/sh

#See for EFI present
if [ -d /sys/firmware/efi ]; then

#Try mount EFI partitions
EFI_DISK=$(/sbin/blkid | grep EFI | cut -b1-9)

if [ $EFI_DISK ]
	then
		mount $EFI_DISK /boot/efi
	else
		exit 0
fi

#See for Windows EFI
if [ -d /boot/efi/EFI/Microsoft ]; then

EFI_UUID="$(/usr/sbin/grub2-probe --target=fs_uuid /boot/efi/EFI/Microsoft/Boot/bootmgfw.efi)"

cat << EOF
menuentry "Microsoft Windows Vista/7/8 UEFI-GPT" {
  insmod part_gpt
  insmod fat
  insmod search_fs_uuid
  insmod chain
  search --fs-uuid --set=root --hint-bios=hd0,gpt1 --hint-efi=hd0,gpt1 --hint-baremetal=ahci0,gpt1 ${EFI_UUID}
  chainloader /efi/Microsoft/Boot/bootmgfw.efi
}
EOF
fi
fi
