diff --git a/util/grub.d/30_os-prober.in b/util/grub.d/30_os-prober.in
index a430e36..8fce7c9 100644
--- a/util/grub.d/30_os-prober.in
+++ b/util/grub.d/30_os-prober.in
@@ -131,6 +131,9 @@ for OS in ${OSPROBED} ; do
   LONGNAME="`echo ${OS} | cut -d ':' -f 2 | tr '^' ' '`"
   LABEL="`echo ${OS} | cut -d ':' -f 3 | tr '^' ' '`"
   BOOT="`echo ${OS} | cut -d ':' -f 4`"
+  FS="`echo ${OS} | cut -d ':' -f 5`"
+  VOLID="`echo ${OS} | cut -d ':' -f 6`"
+  SUBVOL="`echo ${OS} | cut -d ':' -f 7`"
   CLASS="$(echo ${LABEL} | tr '[A-Z]' '[a-z]' | sed 's,[0-9]*$,,')" 
   if [ -z "${CLASS}" ] ; then
     CLASS="unknown";
@@ -168,7 +171,12 @@ EOF
 EOF
     ;;
     linux)
-      LINUXPROBED="`linux-boot-prober ${DEVICE} 2> /dev/null | tr ' ' '^' | paste -s -d ' '`"
+      if [ "x${FS}" = "xbtrfs" ]; then
+        PROBE_PARAMS="${FS} ${VOLID} ${SUBVOL}"
+      else
+        PROBE_PARAMS="${DEVICE}"
+      fi
+      LINUXPROBED="`linux-boot-prober ${PROBE_PARAMS} 2> /dev/null | tr ' ' '^' | paste -s -d ' '`"
       prepare_boot_cache=
       boot_device_id=
       is_first_entry=true
